#!/bin/sh

case $BUTTON in
    1) managewifi ;;
	3) toggle-nmtui ;;
esac

internet() {
    # icons:
    #  - wifi up: 直
    #  - wifi down: 睊
    #  - ethernet up: 
    #  - ethernet down: 

    # WiFi
    grep -q "up" /sys/class/net/w*/operstate && wifiicon="直" \
        || wifiicon="睊"
    if [ "$wifiicon" = "直" ]; then
        activewifi=$(nmcli --terse -fields NAME,TYPE c show --active | \
            awk -F ':' '/wireless/ {printf $1}')
        wifisignal=$(nmcli --terse --fields SSID,SIGNAL d wifi list --rescan no | \
            awk -F ':' '/'"$activewifi"'/ {printf $2"%"}')
        wifiicon="$wifiicon $wifisignal"
    fi

    # Ethernet
    etherneticon="$(sed 's/up//;s/down//' /sys/class/net/e*/operstate)"

    printf "  %s · %s   " "$wifiicon" "$etherneticon"
}

internet
