#!/bin/bash

update_monitors() {
    activemonitors=($(xrandr --listactivemonitors | awk '!/Monitor/ {print $4}'))
    primary="$(xrandr | awk '{if ($2 == "connected" && $3 == "primary") printf $1}')"
    # The next line assumes there is only 1 extra monitor
    extra="$(xrandr | awk '{if ($2 == "connected" && $3 != "primary") printf $1}')"
    for i in "${activemonitors[@]}"; do
        if [[ $i == $extra ]]; then
            secondary=$extra
            break
        fi
    done
    [[ -z $secondary ]] && secondary="$primary"
    for i in {1..10}; do
        sed -E \
            -e 's/^(workspace \$ws'"$i"' output )1$/\1'"$primary"'/' \
            -e 's/^(workspace \$ws'"$i"' output )2$/\1'"$secondary"'/' \
            $HOME/.config/i3/config.template > $HOME/.config/i3/config
    done
}

update_monitors
