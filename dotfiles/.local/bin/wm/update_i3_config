#!/bin/bash

update_monitors() {
    activemonitors=($(xrandr --listactivemonitors | awk '!/Monitor/ {print $4}'))
    primary="$(xrandr | awk '{if ($2 == "connected" && $3 == "primary") printf $1}')"
    # Assume there is only 1 extra monitor
    for i in "${activemonitors[@]}"; do
        if [[ $i != $primary ]]; then
            secondary=$i
            break
        fi
    done
    [[ -z $secondary ]] && secondary="$primary"
    for i in {1..10}; do
        sed -E \
            -e 's/^(workspace \$ws'"$i"' output )1$/\1'"$primary"'/' \
            -e 's/^(workspace \$ws'"$i"' output )2$/\1'"$secondary"'/' \
            -i $HOME/.config/i3/config
    done
}

# Update the config file
[[ -f $HOME/.config/i3/config.template ]] || exit 1
[[ -f $HOME/.config/i3/config ]] && rm $HOME/.config/i3/config
cp $HOME/.config/i3/config.template $HOME/.config/i3/config
chmod 600 $HOME/.config/i3/config

update_monitors
