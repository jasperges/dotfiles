#!/bin/sh

WM_ID=$(xprop -root _NET_ACTIVE_WINDOW | cut -d " " -f 5)
# Go to the current working directory if current window is also the terminal
WM_CLASS=$(xprop -id $WM_ID WM_CLASS | cut -d "=" -f 2 | cut -d "," -f 1 | tr -d '"[:space:]')
if [ "$WM_CLASS" = $TERMINAL ]; then
    WM_NAME="$(xprop -id "$WM_ID" WM_NAME | awk -F " = " '{printf $2}' | tr -d '"')"
    DIR=$(echo "$WM_NAME" | sed -E "s|^.* \((.*)\) - VIM$|\1|;s|~|$HOME|")
fi

if [ -d "$DIR" ]; then
    $TERMINAL --working-directory "$DIR" "$@" &
else
    $TERMINAL "$@" &
fi
